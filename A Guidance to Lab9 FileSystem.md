### Big file

xv6里面一开始是有12个直接索引和一个一级间接索引。现在是要给改成11个直接索引，一个一级和一个二级间接索引。主要是修改inode的结构和系统自定义的宏，比如文件的最大值（MAXFILE要改成用上了所有的块，即一级二级索引，直接索引都用上了以后对应的磁盘块数）。然后修改的地方主要是在fs.c的

+ bmap函数：这个函数是根据inode和inode给出的逻辑的磁盘块号，（其中逻辑的磁盘块号是指位于当前文件的第几块），转化为实际的磁盘块号（实际磁盘块号是磁盘块上的，也就是balloc返回的）。bmap函数首先是去看到底这个inode有没有这个块，要是没有就申请一个，然后记下来返回，要是已经有了的话就直接返回了。那么对于处于一级或者二级索引的块的读取的话，就需要先把索引块读进来（索引块不存在的话也要申请一个索引块），然后在索引块的对应位置去读物理磁盘块号。一级索引和二级索引的区别无非是多读一次索引块罢了。
+ itrunc函数：这个函数是用来删除一个inode的。删除的同时是需要将这个inode对应的磁盘块也清空的。那也很简单了，看看磁盘块有没有，要是有就清空，没有就不用管。要是索引块根本就没有，那就不用处理，要是有索引块，就把索引块读进来，然后检查每个索引有没有，要是有就清空，没有就不用管，最后再把索引块清空就好了。二级索引无非是进行两次这样的操作。



### Symbolic link

A symbolic link is a file that contains the path name for another file; that path name can be relative or absolute.

这个实验里面仅有对于文件的symbolic link，不考虑文件夹

`symlink`函数的步骤：

+ 先把参数用`argstr`读进来，然后创建一个`T_SYMLINK`的文件（参考`sys_mknod`和`sys_open`
+ ~~修改`inode`结构体，加一个存储路径的项~~（这个不对，底下会说）
+ 成功返回0

修改open函数，使得适配`T_SYMLINK`文件

+ 遇到`T_SYMLINK`文件要去`inode`读对应的路径

+ 设置一个阈值，不让他递归的太深
+ 遇到`O_NOFLLOW`就是打开`symlink`对应的文件，如果指明了`O_NOFLLOW`就和正常处理是一样的
+ `link`和`Unlink`也是打开`symlink`对应的文件,实际上并不需要修改这两个文件



注意的小问题，说小也不小。。。拖了我好久

+ 一开始把链接的路径直接存到了结构体里面，但是磁盘里面并没有这个结构，这就造成了问题。后来探索半天才发现是写到`inode`对应的数据块里面，然后用的是`writei`和`readi`函数.因为这个文件一定是空的，所以偏移直接设为0就可以了

说明一下，这里修改了`gradelib`才能过，因为服务器实在太 慢 了！把`timeout`改的长一点就好了

